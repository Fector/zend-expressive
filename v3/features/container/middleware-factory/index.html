<!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="zend-expressive: PSR-7 Middleware Microframework">  
    <link rel="shortcut icon" href="../../../../img/favicon.ico">

    <title>The Middleware Factory - Expressive</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../../../css/styles-288837cc22.css">
        <link href="../../../../css/zend-expressive.css" rel="stylesheet">

    
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <span class="navbar-brand">
                <a class="logo-link" href="https://framework.zend.com/" data-toggle="tooltip" data-placement="bottom" title="Go to the ZF homepage"><img src="../../../../img/zf-logo-mark.svg" height="28" alt="Zend Framework" /></a>
                <a href="../../../..">Expressive</a>
            </span>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                
                    <li >
                        <a href="../../../..">Home</a>
                    </li>
                
                
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Getting Started <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            

<li >
    <a href="../../../getting-started/features/">Overview and Features</a>
</li>


                        
                            

<li >
    <a href="../../../getting-started/quick-start/">Quick Start</a>
</li>


                        
                        </ul>
                    </li>
                
                
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Features <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            

<li >
    <a href="../../middleware-types/">Middleware Types</a>
</li>


                        
                            

<li >
    <a href="../../application/">Applications</a>
</li>


                        
                            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Containers</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../intro/">Introduction</a>
</li>


        
            

<li >
    <a href="../factories/">Container Factories</a>
</li>


        
            

<li >
    <a href="../delegator-factories/">Delegator Factories</a>
</li>


        
            

<li >
    <a href="../middleware-container/">The Middleware Container</a>
</li>


        
            

<li class="active">
    <a href="./">The Middleware Factory</a>
</li>


        
            

<li >
    <a href="../zend-servicemanager/">Using zend-servicemanager</a>
</li>


        
            

<li >
    <a href="../pimple/">Using Pimple</a>
</li>


        
            

<li >
    <a href="../aura-di/">Using Aura.Di</a>
</li>


        
    </ul>
  </li>


                        
                            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Routing Adapters</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../router/intro/">Introduction</a>
</li>


        
            

<li >
    <a href="../../router/interface/">Routing Interface</a>
</li>


        
            

<li >
    <a href="../../router/route-collector/">The Route Collector</a>
</li>


        
            

<li >
    <a href="../../router/uri-generation/">URI Generation</a>
</li>


        
            

<li >
    <a href="../../router/piping/">Routing vs Piping</a>
</li>


        
            

<li >
    <a href="../../router/aura/">Using Aura</a>
</li>


        
            

<li >
    <a href="../../router/fast-route/">Using FastRoute</a>
</li>


        
            

<li >
    <a href="../../router/zf2/">Using zend-router</a>
</li>


        
    </ul>
  </li>


                        
                            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Templating</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../template/intro/">Introduction</a>
</li>


        
            

<li >
    <a href="../../template/interface/">Template Renderer Interface</a>
</li>


        
            

<li >
    <a href="../../template/request-handlers/">Templated Request Handlers</a>
</li>


        
            

<li >
    <a href="../../template/plates/">Using Plates</a>
</li>


        
            

<li >
    <a href="../../template/twig/">Using Twig</a>
</li>


        
            

<li >
    <a href="../../template/zend-view/">Using zend-view</a>
</li>


        
    </ul>
  </li>


                        
                            

<li >
    <a href="../../error-handling/">Error Handling</a>
</li>


                        
                            

<li >
    <a href="../../modular-applications/">Modular Applications</a>
</li>


                        
                            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Middleware</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../middleware/routing-and-dispatch-middleware/">Routing and Dispatch Middleware</a>
</li>


        
            

<li >
    <a href="../../middleware/implicit-methods-middleware/">Implicit HEAD and OPTIONS Middleware</a>
</li>


        
            

<li >
    <a href="../../middleware/method-not-allowed-middleware/">Returning Method Not Allowed</a>
</li>


        
    </ul>
  </li>


                        
                            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Helpers</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../helpers/intro/">Introduction</a>
</li>


        
            

<li >
    <a href="../../helpers/url-helper/">UrlHelper</a>
</li>


        
            

<li >
    <a href="../../helpers/server-url-helper/">ServerUrlHelper</a>
</li>


        
            

<li >
    <a href="../../helpers/body-parse/">Body Parsing Middleware</a>
</li>


        
            

<li >
    <a href="../../helpers/content-length/">Content-Length Middleware</a>
</li>


        
    </ul>
  </li>


                        
                            

<li >
    <a href="../../emitters/">Emitters</a>
</li>


                        
                        </ul>
                    </li>
                
                
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Cookbook <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            

<li >
    <a href="../../../cookbook/autowiring-routes-and-pipelines/">Autowiring routes and pipeline middleware</a>
</li>


                        
                            

<li >
    <a href="../../../cookbook/common-prefix-for-routes/">Prepending a common path to all routes</a>
</li>


                        
                            

<li >
    <a href="../../../cookbook/route-specific-pipeline/">Route-specific middleware pipelines</a>
</li>


                        
                            

<li >
    <a href="../../../cookbook/using-custom-view-helpers/">Registering custom view helpers when using zend-view</a>
</li>


                        
                            

<li >
    <a href="../../../cookbook/double-pass-middleware/">Using double-pass middleware</a>
</li>


                        
                            

<li >
    <a href="../../../cookbook/using-zend-form-view-helpers/">Using zend-form view helpers</a>
</li>


                        
                            

<li >
    <a href="../../../cookbook/using-a-base-path/">Using Expressive from a subdirectory</a>
</li>


                        
                            

<li >
    <a href="../../../cookbook/setting-locale-depending-routing-parameter/">Setting a locale based on a routing parameter</a>
</li>


                        
                            

<li >
    <a href="../../../cookbook/setting-locale-without-routing-parameter/">Setting a locale without a routing parameter</a>
</li>


                        
                            

<li >
    <a href="../../../cookbook/debug-toolbars/">Enabling debug toolbars</a>
</li>


                        
                            

<li >
    <a href="../../../cookbook/flash-messengers/">Flash Messengers</a>
</li>


                        
                            

<li >
    <a href="../../../cookbook/passing-data-between-middleware/">Passing data between middleware</a>
</li>


                        
                        </ul>
                    </li>
                
                
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reference <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            

<li >
    <a href="../../../why-expressive/">Why choose Expressive?</a>
</li>


                        
                            

<li >
    <a href="../../../reference/cli-tooling/">CLI Tooling</a>
</li>


                        
                            

<li >
    <a href="../../../reference/expressive-projects/">Expressive Projects</a>
</li>


                        
                            

<li >
    <a href="../../../reference/migration/">Migration</a>
</li>


                        
                        </ul>
                    </li>
                
                
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">v2 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            

<li >
    <a href="../../../../v2/">Home</a>
</li>


                        
                            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Getting Started</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../../../v2/getting-started/features/">Overview and Features</a>
</li>


        
            

<li >
    <a href="../../../../v2/getting-started/standalone/">Quick Start: Standalone</a>
</li>


        
            

<li >
    <a href="../../../../v2/getting-started/skeleton/">Quick Start: Skeleton Installer</a>
</li>


        
    </ul>
  </li>


                        
                            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Features</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../../../v2/features/middleware-types/">Middleware Types</a>
</li>


        
            

<li >
    <a href="../../../../v2/features/application/">Applications</a>
</li>


        
            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Containers</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../../../v2/features/container/intro/">Introduction</a>
</li>


        
            

<li >
    <a href="../../../../v2/features/container/factories/">Container Factories</a>
</li>


        
            

<li >
    <a href="../../../../v2/features/container/delegator-factories/">Delegator Factories</a>
</li>


        
            

<li >
    <a href="../../../../v2/features/container/zend-servicemanager/">Using zend-servicemanager</a>
</li>


        
            

<li >
    <a href="../../../../v2/features/container/pimple/">Using Pimple</a>
</li>


        
            

<li >
    <a href="../../../../v2/features/container/aura-di/">Using Aura.Di</a>
</li>


        
    </ul>
  </li>


        
            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Routing Adapters</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../../../v2/features/router/intro/">Introduction</a>
</li>


        
            

<li >
    <a href="../../../../v2/features/router/interface/">Routing Interface</a>
</li>


        
            

<li >
    <a href="../../../../v2/features/router/uri-generation/">URI Generation</a>
</li>


        
            

<li >
    <a href="../../../../v2/features/router/piping/">Routing vs Piping</a>
</li>


        
            

<li >
    <a href="../../../../v2/features/router/aura/">Using Aura</a>
</li>


        
            

<li >
    <a href="../../../../v2/features/router/fast-route/">Using FastRoute</a>
</li>


        
            

<li >
    <a href="../../../../v2/features/router/zf2/">Using the ZF2 Router</a>
</li>


        
    </ul>
  </li>


        
            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Templating</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../../../v2/features/template/intro/">Introduction</a>
</li>


        
            

<li >
    <a href="../../../../v2/features/template/interface/">Template Renderer Interface</a>
</li>


        
            

<li >
    <a href="../../../../v2/features/template/middleware/">Templated Middleware</a>
</li>


        
            

<li >
    <a href="../../../../v2/features/template/plates/">Using Plates</a>
</li>


        
            

<li >
    <a href="../../../../v2/features/template/twig/">Using Twig</a>
</li>


        
            

<li >
    <a href="../../../../v2/features/template/zend-view/">Using zend-view</a>
</li>


        
    </ul>
  </li>


        
            

<li >
    <a href="../../../../v2/features/error-handling/">Error Handling</a>
</li>


        
            

<li >
    <a href="../../../../v2/features/modular-applications/">Modular Applications</a>
</li>


        
            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Middleware</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../../../v2/features/middleware/implicit-methods-middleware/">Implicit HEAD and OPTIONS Middleware</a>
</li>


        
    </ul>
  </li>


        
            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Helpers</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../../../v2/features/helpers/intro/">Introduction</a>
</li>


        
            

<li >
    <a href="../../../../v2/features/helpers/url-helper/">UrlHelper</a>
</li>


        
            

<li >
    <a href="../../../../v2/features/helpers/server-url-helper/">ServerUrlHelper</a>
</li>


        
            

<li >
    <a href="../../../../v2/features/helpers/body-parse/">Body Parsing Middleware</a>
</li>


        
            

<li >
    <a href="../../../../v2/features/helpers/content-length/">Content-Length Middleware</a>
</li>


        
    </ul>
  </li>


        
            

<li >
    <a href="../../../../v2/features/emitters/">Emitters</a>
</li>


        
    </ul>
  </li>


                        
                            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Cookbook</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../../../v2/cookbook/autowiring-routes-and-pipelines/">Autowiring routes and pipeline middleware</a>
</li>


        
            

<li >
    <a href="../../../../v2/cookbook/common-prefix-for-routes/">Prepending a common path to all routes</a>
</li>


        
            

<li >
    <a href="../../../../v2/cookbook/route-specific-pipeline/">Route-specific middleware pipelines</a>
</li>


        
            

<li >
    <a href="../../../../v2/cookbook/using-custom-view-helpers/">Registering custom view helpers when using zend-view</a>
</li>


        
            

<li >
    <a href="../../../../v2/cookbook/using-zend-form-view-helpers/">Using zend-form view helpers</a>
</li>


        
            

<li >
    <a href="../../../../v2/cookbook/using-a-base-path/">Using Expressive from a subdirectory</a>
</li>


        
            

<li >
    <a href="../../../../v2/cookbook/setting-locale-depending-routing-parameter/">Setting a locale based on a routing parameter</a>
</li>


        
            

<li >
    <a href="../../../../v2/cookbook/setting-locale-without-routing-parameter/">Setting a locale without a routing parameter</a>
</li>


        
            

<li >
    <a href="../../../../v2/cookbook/debug-toolbars/">Enabling debug toolbars</a>
</li>


        
            

<li >
    <a href="../../../../v2/cookbook/using-routed-middleware-class-as-controller/">Handling multiple routes in a single class</a>
</li>


        
            

<li >
    <a href="../../../../v2/cookbook/flash-messengers/">Flash Messengers</a>
</li>


        
            

<li >
    <a href="../../../../v2/cookbook/passing-data-between-middleware/">Passing data between middleware</a>
</li>


        
    </ul>
  </li>


                        
                            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Reference</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../../../v2/why-expressive/">Why choose Expressive?</a>
</li>


        
            

<li >
    <a href="../../../../v2/reference/cli-tooling/">CLI Tooling</a>
</li>


        
            

<li >
    <a href="../../../../v2/reference/usage-examples/">Examples</a>
</li>


        
            

<li >
    <a href="../../../../v2/reference/expressive-projects/">Expressive Projects</a>
</li>


        
            

<li >
    <a href="../../../../v2/reference/migration/">Migration</a>
</li>


        
    </ul>
  </li>


                        
                            

<li >
    <a href="../../../../v2/why-expressive/">Why choose Expressive?</a>
</li>


                        
                            

<li >
    <a href="../../../../v2/reference/cli-tooling/">CLI Tooling</a>
</li>


                        
                            

<li >
    <a href="../../../../v2/reference/usage-examples/">Examples</a>
</li>


                        
                            

<li >
    <a href="../../../../v2/reference/expressive-projects/">Expressive Projects</a>
</li>


                        
                            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Migration</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../../../v2/reference/migration/">To version 2</a>
</li>


        
            

<li >
    <a href="../../../../v2/reference/migration-to-v2-2/">To version 2.2</a>
</li>


        
    </ul>
  </li>


                        
                        </ul>
                    </li>
                
                
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">v1 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            

<li >
    <a href="../../../../v1/">Home</a>
</li>


                        
                            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Getting Started</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../../../v1/getting-started/features/">Overview and Features</a>
</li>


        
            

<li >
    <a href="../../../../v1/getting-started/standalone/">Quick Start: Standalone</a>
</li>


        
            

<li >
    <a href="../../../../v1/getting-started/skeleton/">Quick Start: Skeleton Installer</a>
</li>


        
    </ul>
  </li>


                        
                            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Features</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../../../v1/features/application/">Applications</a>
</li>


        
            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Containers</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../../../v1/features/container/intro/">Introduction</a>
</li>


        
            

<li >
    <a href="../../../../v1/features/container/factories/">Container Factories</a>
</li>


        
            

<li >
    <a href="../../../../v1/features/container/zend-servicemanager/">Using zend-servicemanager</a>
</li>


        
            

<li >
    <a href="../../../../v1/features/container/pimple/">Using Pimple</a>
</li>


        
            

<li >
    <a href="../../../../v1/features/container/aura-di/">Using Aura.Di</a>
</li>


        
    </ul>
  </li>


        
            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Routing Adapters</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../../../v1/features/router/intro/">Introduction</a>
</li>


        
            

<li >
    <a href="../../../../v1/features/router/interface/">Routing Interface</a>
</li>


        
            

<li >
    <a href="../../../../v1/features/router/uri-generation/">URI Generation</a>
</li>


        
            

<li >
    <a href="../../../../v1/features/router/piping/">Routing vs Piping</a>
</li>


        
            

<li >
    <a href="../../../../v1/features/router/aura/">Using Aura</a>
</li>


        
            

<li >
    <a href="../../../../v1/features/router/fast-route/">Using FastRoute</a>
</li>


        
            

<li >
    <a href="../../../../v1/features/router/zf2/">Using the ZF2 Router</a>
</li>


        
    </ul>
  </li>


        
            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Templating</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../../../v1/features/template/intro/">Introduction</a>
</li>


        
            

<li >
    <a href="../../../../v1/features/template/interface/">Template Renderer Interface</a>
</li>


        
            

<li >
    <a href="../../../../v1/features/template/middleware/">Templated Middleware</a>
</li>


        
            

<li >
    <a href="../../../../v1/features/template/plates/">Using Plates</a>
</li>


        
            

<li >
    <a href="../../../../v1/features/template/twig/">Using Twig</a>
</li>


        
            

<li >
    <a href="../../../../v1/features/template/zend-view/">Using zend-view</a>
</li>


        
    </ul>
  </li>


        
            

<li >
    <a href="../../../../v1/features/error-handling/">Error Handling</a>
</li>


        
            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Helpers</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../../../v1/features/helpers/intro/">Introduction</a>
</li>


        
            

<li >
    <a href="../../../../v1/features/helpers/url-helper/">UrlHelper</a>
</li>


        
            

<li >
    <a href="../../../../v1/features/helpers/server-url-helper/">ServerUrlHelper</a>
</li>


        
            

<li >
    <a href="../../../../v1/features/helpers/body-parse/">Body Parsing Middleware</a>
</li>


        
    </ul>
  </li>


        
            

<li >
    <a href="../../../../v1/features/emitters/">Emitters</a>
</li>


        
    </ul>
  </li>


                        
                            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Cookbook</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../../../v1/cookbook/common-prefix-for-routes/">Prepending a common path to all routes</a>
</li>


        
            

<li >
    <a href="../../../../v1/cookbook/route-specific-pipeline/">Route-specific middleware pipelines</a>
</li>


        
            

<li >
    <a href="../../../../v1/cookbook/custom-404-page-handling/">Setting custom 404 page handling</a>
</li>


        
            

<li >
    <a href="../../../../v1/cookbook/using-custom-view-helpers/">Registering custom view helpers when using zend-view</a>
</li>


        
            

<li >
    <a href="../../../../v1/cookbook/using-zend-form-view-helpers/">Using zend-form view helpers</a>
</li>


        
            

<li >
    <a href="../../../../v1/cookbook/using-a-base-path/">Using Expressive from a subdirectory</a>
</li>


        
            

<li >
    <a href="../../../../v1/cookbook/modular-layout/">Building modular applications</a>
</li>


        
            

<li >
    <a href="../../../../v1/cookbook/setting-locale-depending-routing-parameter/">Setting a locale based on a routing parameter</a>
</li>


        
            

<li >
    <a href="../../../../v1/cookbook/setting-locale-without-routing-parameter/">Setting a locale without a routing parameter</a>
</li>


        
            

<li >
    <a href="../../../../v1/cookbook/debug-toolbars/">Enabling debug toolbars</a>
</li>


        
            

<li >
    <a href="../../../../v1/cookbook/using-routed-middleware-class-as-controller/">Handling multiple routes in a single class</a>
</li>


        
            

<li >
    <a href="../../../../v1/cookbook/flash-messengers/">Flash Messengers</a>
</li>


        
    </ul>
  </li>


                        
                            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Reference</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../../../v1/why-expressive/">Why choose Expressive?</a>
</li>


        
            

<li >
    <a href="../../../../v1/reference/usage-examples/">Examples</a>
</li>


        
            

<li >
    <a href="../../../../v1/reference/expressive-projects/">Expressive Projects</a>
</li>


        
            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Migration</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../../../v1/reference/migration/rc-to-v1/">From RC5 and Earlier</a>
</li>


        
            

<li >
    <a href="../../../../v1/reference/migration/to-v1-1/">To Expressive 1.1</a>
</li>


        
    </ul>
  </li>


        
    </ul>
  </li>


                        
                        </ul>
                    </li>
                
                
                
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" class="component-toggle" data-toggle="tooltip" data-placement="bottom" title="Show component list">
                        <i class="fa fa-book"></i> Components
                    </a>
                </li>

                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li>
                        <a href="https://github.com/zendframework/zend-expressive/">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

    <!-- content:begin -->
    <div id="page-top" class="container docs">
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#the-middleware-factory">The Middleware Factory</a></li>
        
            <li><a href="#callable">callable</a></li>
        
            <li><a href="#handler">handler</a></li>
        
            <li><a href="#lazy">lazy</a></li>
        
            <li><a href="#pipeline">pipeline</a></li>
        
            <li><a href="#prepare">prepare</a></li>
        
            <li><a href="#usage-in-bootstrapping">Usage in bootstrapping</a></li>
        
    
    </ul>

    
    <ul class="pager hidden-print">
      <li class="previous">
        <a rel="prev" href="../middleware-container/"><i class="fa fa-arrow-left"></i> Previous</a>
      </li>
      <li class="next">
        <a rel="next" href="../zend-servicemanager/">Next <i class="fa fa-arrow-right"></i></a>
      </li>
    </ul>
    
</div></div>
        <div class="col-md-9" role="main">

<ol class="breadcrumb" role="navigation" aria-label="breadcrumbs navigation">
  <li><a href="../../../..">Expressive</a></li>
  
    
      
        <li>Features</li>
      
    
      
        <li>Containers</li>
      
    
  
  <li class="active">The Middleware Factory</li>
</ol>

<h1 id="the-middleware-factory">The Middleware Factory</h1>
<p>With version 3, we made a conscious choice to use strong type-hinting wherever
possible. However, we also recognize that doing so can sometimes be an
inconvenience to the user and lead to an explosion in code verbosity.</p>
<p>One area in particular that concerned us was the <code>Application</code> instance itself,
and the various methods it exposes for piping and routing middleware. If we made
each of these strictly typed, users would be forced to write code that looks
like the following:</p>
<pre class="codehilite"><code class="language-php">use Psr\Container\ContainerInterface;
use Zend\Expressive\Application;
use Zend\Expressive\Middleware\LazyLoadingMiddleware;
use Zend\Stratigility\MiddlewarePipe;

use function Zend\Stratigility\middleware;
use function Zend\Stratigility\path;

return function (Application $app, ContainerInterface $container) : void {
    $app-&gt;pipe(path(
        '/foo',
        new LazyLoadingMiddleware(App\FooMiddleware::class, $container)
    ));

    $app-&gt;pipe(middleware(function ($request, $handler) {
        // ...
    }));

    $booksPipeline = new MiddlewarePipe();
    $booksPipeline-&gt;pipe(new LazyLoadingMiddleware(
        Zend\ProblemDetails\ProblemDetailsMiddleware::class,
        $container
    ));
    $booksPipeline-&gt;pipe(new LazyLoadingMiddleware(
        App\SessionMiddleware::class,
        $container
    ));
    $booksPipeline-&gt;pipe(new LazyLoadingMiddleware(
        App\AuthenticationMiddleware::class,
        $container
    ));
    $booksPipeline-&gt;pipe(new LazyLoadingMiddleware(
        App\AuthorizationMiddleware::class,
        $container
    ));
    $booksPipeline-&gt;pipe(new LazyLoadingMiddleware(
        Zend\Expressive\Helper\BodyParams\BodyParamsMiddleware::class
        $container
    ));
    $booksPipeline-&gt;pipe(new LazyLoadingMiddleware(
        App\ValidationMiddleware::class
        $container
    ));
    $booksPipeline-&gt;pipe(new LazyLoadingMiddleware(
        App\Handler\CreateBookHandler::class
        $container
    ));
    $app-&gt;post('/books/{id:\d+}', $booksPipeline);
};</code></pre>

<p>Additionally, this would pose an enormous burden when migrating to version 3.</p>
<p>For these reasons, we developed the class <code>Zend\Expressive\MiddlewareFactory</code>.
It composes a <a href="../middleware-container/">MiddlewareContainer</a> in order to back
the following operations.</p>
<h2 id="callable">callable</h2>
<pre class="codehilite"><code class="language-php">$middleware = $factory-&gt;callable(function ($request, $handler) {
});</code></pre>

<p>This method takes a callable middleware, and decorates it as a
<code>Zend\Stratigility\Middleware\CallableMiddlewareDecorator</code> instance.</p>
<h2 id="handler">handler</h2>
<pre class="codehilite"><code class="language-php">$middleware = $factory-&gt;handler($requestHandler);</code></pre>

<p>This method takes a PSR-15 request handler instance and decorates it as a
<code>Zend\Stratigility\Middleware\RequestHandlerMiddleware</code> instance.</p>
<h2 id="lazy">lazy</h2>
<pre class="codehilite"><code class="language-php">$middleware = $factory-&gt;lazy(App\Middleware\FooMiddleware::class);</code></pre>

<p>This method decorates the service name using
<code>Zend\Expressive\Middlware\LazyLoadingMiddleware</code>, passing the composed
<code>MiddlewareContainer</code> to the instance during instantiation.</p>
<h2 id="pipeline">pipeline</h2>
<pre class="codehilite"><code class="language-php">$pipeline = $factory-&gt;pipeline(
    $middlewareInstance,
    'MiddlewareServiceName',
    function ($request, $handler) {
    },
    $requestHandlerInstance
);</code></pre>

<p>Creates and returns a <code>Zend\Stratigility\MiddlewarePipe</code>, after passing each
argument to <code>prepare()</code> first.</p>
<p>(You may pass an array of values instead of individual arguments as well.)</p>
<h2 id="prepare">prepare</h2>
<pre class="codehilite"><code class="language-php">$middleware = $factory-&gt;prepare($middleware);</code></pre>

<p>Inspects the provided middleware argument, with the following behavior:</p>
<ul>
<li><code>MiddlewareInterface</code> instances are returned verbatim.</li>
<li><code>RequestHandlerInterface</code> instances are decorated using <code>handler()</code>.</li>
<li><code>callable</code> arguments are decorated using <code>callable()</code>.</li>
<li><code>string</code> arguments are decorated using <code>lazy()</code>.</li>
<li><code>array</code> arguments are decorated using <code>pipeline()</code>.</li>
</ul>
<h2 id="usage-in-bootstrapping">Usage in bootstrapping</h2>
<p>The skeleton defines two files <code>config/pipeline.php</code> and <code>config/routes.php</code>.
These are expected to return a callable with the following signature:</p>
<pre class="codehilite"><code class="language-php">use Psr\Container\ContainerInterface;
use Zend\Expressive\Application;
use Zend\Expressive\MiddlewareFactory;

return function (Application $app, MiddlewareFactory $factory, ContainerInterface $container) : void {
};</code></pre>

<p>Note that the <code>MiddlewareFactory</code> is passed to these callables; this gives you
the ability to use it for more complex piping and routing needs, including
creating nested pipelines.</p>
<p>As an example, we'll rewrite our initial example to use the <code>MiddlewareFactory</code>:</p>
<pre class="codehilite"><code class="language-php">use Psr\Container\ContainerInterface;
use Zend\Expressive\Application;
use Zend\Expressive\MiddlewareFactory;

use function Zend\Stratigility\path;

return function (Application $app, MiddlewareFactory $factory, ContainerInterface $container) : void {
    $app-&gt;pipe(path('/foo', $factory-&gt;prepare(App\FooMiddleware::class)));

    $app-&gt;pipe($factory-&gt;prepare(function ($request, $handler) {
        // ...
    }));

    $app-&gt;post('/books/{id:\d+}', $factory-&gt;pipeline(
        ProblemDetailsMiddleware::class,
        App\SessionMiddleware::class,
        App\AuthenticationMiddleware::class,
        App\AuthorizationMiddleware::class,
        Zend\Expressive\Helper\BodyParams\BodyParamsMiddleware::class,
        App\ValidationMiddleware::class,
        App\Handler\CreateBookHandler::class
    ));
};</code></pre>

<blockquote>
<h4 id="further-simplifications">Further simplifications</h4>
<p>Internally, <code>Application</code>'s <code>pipe()</code> and various routing methods make use of
the <code>MiddlewareFactory</code> already; <code>pipe()</code> also already makes use of <code>path()</code>
as well. As such, usage of the <code>MiddlewareFactory</code> is not strictly necessary
in the above example; it is used for illustrative purposes only.</p>
</blockquote>

<hr />


<nav>
  <ul class="pager hidden-print">
    <li class="previous">
      <a rel="prev" href="../middleware-container/"><i class="fa fa-arrow-left"></i> Previous</a>
    </li>
    <li class="next">
      <a rel="next" href="../zend-servicemanager/">Next <i class="fa fa-arrow-right"></i></a>
    </li>
  </ul>
</nav>
</div>
        
    </div>
    <!-- content:end -->

    <div id="footerwrap">
    <div class="container">
        <div class="row site-map">
            <div class="col-lg-3">
              <p>
                <strong>Zend Framework</strong><br />
                <a href="https://framework.zend.com/">framework.zend.com</a><br />
                <a href="https://docs.zendframework.com">docs.zendframework.com</a><br />
                <a href="https://packages.zendframework.com">packages.zendframework.com</a><br />
                <a href="https://apigility.org">apigility.org</a><br />
              </p>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12 centered">
                <a class="back-to-top" href="#page-top"><i class="fa fa-chevron-circle-up fa-4" aria-hidden="true"></i></a>
            </div>
        </div>

        <div class="spacing"></div>

        <div class="row">
            <div class="col-lg-8">
                <h4>Copyright</h4>
                <div class="hline-w"></div>

                <p>&copy; 2006-2017 by <a href="https://www.zend.com/">Zend</a>, a <a href="https://www.roguewave.com/">Rogue Wave Company</a>.</p>
            </div>

            <div class="col-lg-4">
                <h4>Contacts</h4>
                <div class="hline-w"></div>
                <p>
                    <a href="https://discourse.zendframework.com" class="btn-social btn-outline" alt="Forum" title="Forum"><i class="fa fa-comments"></i></a>
                    <a href="https://zendframework-slack.herokuapp.com" class="btn-social btn-outline" alt="Slack" title="Slack"><i class="fa fa-slack"></i></a>
                    <a href="https://github.com/zendframework" class="btn-social btn-outline" alt="Github" title="Github"><i class="fa fa-github"></i></a>
                    <a href="https://twitter.com/zfdevteam" class="btn-social btn-outline" alt="Twitter" title="Twitter"><i class="fa fa-twitter"></i></a>
                </p>
            </div>
        </div>
    </div>
</div>

    <script src="https://cdn.jsdelivr.net/npm/jquery@2.2.4/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>
    <script>var base_url = '../../../..';</script>
    <script src="../../../../js/scripts-0b6185f4a5.js"></script>
    <script data-main="../../../../mkdocs/js/search.js" src="../../../../mkdocs/js/require.js"></script>
        <script src="../../../../search/require.js"></script>
        <script src="../../../../search/search.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    <div class="zf-components">
  <div class="zf-components-grid">
    <div class="zf-logo">
      <a href="https://framework.zend.com" data-toggle="tooltip" data-placement="bottom" title="Go to the ZF homepage"><img src="../../../../img/zf-logo-mark.svg" alt="Zend Framework" width="250" /></a>
    </div>

    <div class="component-list"></div>

    <p class="zf-components-rollup"><a href="#">Hide list</a></p>
  </div>
</div>

</body>


</html>
