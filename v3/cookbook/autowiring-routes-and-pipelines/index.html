<!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="zend-expressive: PSR-7 Middleware Microframework">  
    <link rel="shortcut icon" href="../../../img/favicon.ico">

    <title>Autowiring routes and pipeline middleware - Expressive</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../../css/styles-288837cc22.css">
        <link href="../../../css/zend-expressive.css" rel="stylesheet">

    
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <span class="navbar-brand">
                <a class="logo-link" href="https://framework.zend.com/" data-toggle="tooltip" data-placement="bottom" title="Go to the ZF homepage"><img src="../../../img/zf-logo-mark.svg" height="28" alt="Zend Framework" /></a>
                <a href="../../..">Expressive</a>
            </span>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                
                    <li >
                        <a href="../../..">Home</a>
                    </li>
                
                
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Getting Started <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            

<li >
    <a href="../../getting-started/features/">Overview and Features</a>
</li>


                        
                            

<li >
    <a href="../../getting-started/quick-start/">Quick Start</a>
</li>


                        
                        </ul>
                    </li>
                
                
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Features <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            

<li >
    <a href="../../features/middleware-types/">Middleware Types</a>
</li>


                        
                            

<li >
    <a href="../../features/application/">Applications</a>
</li>


                        
                            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Containers</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../features/container/intro/">Introduction</a>
</li>


        
            

<li >
    <a href="../../features/container/factories/">Container Factories</a>
</li>


        
            

<li >
    <a href="../../features/container/delegator-factories/">Delegator Factories</a>
</li>


        
            

<li >
    <a href="../../features/container/middleware-container/">The Middleware Container</a>
</li>


        
            

<li >
    <a href="../../features/container/middleware-factory/">The Middleware Factory</a>
</li>


        
            

<li >
    <a href="../../features/container/zend-servicemanager/">Using zend-servicemanager</a>
</li>


        
            

<li >
    <a href="../../features/container/pimple/">Using Pimple</a>
</li>


        
            

<li >
    <a href="../../features/container/aura-di/">Using Aura.Di</a>
</li>


        
            

<li >
    <a href="../../features/container/config/">Container configuration</a>
</li>


        
    </ul>
  </li>


                        
                            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Routing Adapters</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../features/router/intro/">Introduction</a>
</li>


        
            

<li >
    <a href="../../features/router/interface/">Routing Interface</a>
</li>


        
            

<li >
    <a href="../../features/router/route-collector/">The Route Collector</a>
</li>


        
            

<li >
    <a href="../../features/router/uri-generation/">URI Generation</a>
</li>


        
            

<li >
    <a href="../../features/router/piping/">Routing vs Piping</a>
</li>


        
            

<li >
    <a href="../../features/router/aura/">Using Aura</a>
</li>


        
            

<li >
    <a href="../../features/router/fast-route/">Using FastRoute</a>
</li>


        
            

<li >
    <a href="../../features/router/zf2/">Using zend-router</a>
</li>


        
    </ul>
  </li>


                        
                            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Templating</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../features/template/intro/">Introduction</a>
</li>


        
            

<li >
    <a href="../../features/template/interface/">Template Renderer Interface</a>
</li>


        
            

<li >
    <a href="../../features/template/request-handlers/">Templated Request Handlers</a>
</li>


        
            

<li >
    <a href="../../features/template/plates/">Using Plates</a>
</li>


        
            

<li >
    <a href="../../features/template/twig/">Using Twig</a>
</li>


        
            

<li >
    <a href="../../features/template/zend-view/">Using zend-view</a>
</li>


        
    </ul>
  </li>


                        
                            

<li >
    <a href="../../features/error-handling/">Error Handling</a>
</li>


                        
                            

<li >
    <a href="../../features/modular-applications/">Modular Applications</a>
</li>


                        
                            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Middleware</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../features/middleware/routing-and-dispatch-middleware/">Routing and Dispatch Middleware</a>
</li>


        
            

<li >
    <a href="../../features/middleware/implicit-methods-middleware/">Implicit HEAD and OPTIONS Middleware</a>
</li>


        
            

<li >
    <a href="../../features/middleware/method-not-allowed-middleware/">Returning Method Not Allowed</a>
</li>


        
    </ul>
  </li>


                        
                            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Helpers</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../features/helpers/intro/">Introduction</a>
</li>


        
            

<li >
    <a href="../../features/helpers/url-helper/">UrlHelper</a>
</li>


        
            

<li >
    <a href="../../features/helpers/server-url-helper/">ServerUrlHelper</a>
</li>


        
            

<li >
    <a href="../../features/helpers/body-parse/">Body Parsing Middleware</a>
</li>


        
            

<li >
    <a href="../../features/helpers/content-length/">Content-Length Middleware</a>
</li>


        
    </ul>
  </li>


                        
                            

<li >
    <a href="../../features/emitters/">Emitters</a>
</li>


                        
                        </ul>
                    </li>
                
                
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Cookbook <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            

<li class="active">
    <a href="./">Autowiring routes and pipeline middleware</a>
</li>


                        
                            

<li >
    <a href="../using-a-base-path/">Using Expressive from a subdirectory</a>
</li>


                        
                            

<li >
    <a href="../common-prefix-for-routes/">Prepending a common path to all routes</a>
</li>


                        
                            

<li >
    <a href="../passing-data-between-middleware/">Passing data between middleware</a>
</li>


                        
                            

<li >
    <a href="../access-common-data-in-templates/">Provide Access to Common Data In Templates</a>
</li>


                        
                            

<li >
    <a href="../route-specific-pipeline/">Route-specific middleware pipelines</a>
</li>


                        
                            

<li >
    <a href="../host-segregated-middleware/">Segregating middleware by host</a>
</li>


                        
                            

<li >
    <a href="../double-pass-middleware/">Using double-pass middleware</a>
</li>


                        
                            

<li >
    <a href="../setting-locale-depending-routing-parameter/">Setting a locale based on a routing parameter</a>
</li>


                        
                            

<li >
    <a href="../setting-locale-without-routing-parameter/">Setting a locale without a routing parameter</a>
</li>


                        
                            

<li >
    <a href="../debug-toolbars/">Enabling debug toolbars</a>
</li>


                        
                            

<li >
    <a href="../flash-messengers/">Flash Messengers</a>
</li>


                        
                            

<li >
    <a href="../using-custom-view-helpers/">Registering custom view helpers when using zend-view</a>
</li>


                        
                            

<li >
    <a href="../using-zend-form-view-helpers/">Using zend-form view helpers</a>
</li>


                        
                        </ul>
                    </li>
                
                
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reference <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            

<li >
    <a href="../../why-expressive/">Why choose Expressive?</a>
</li>


                        
                            

<li >
    <a href="../../reference/cli-tooling/">CLI Tooling</a>
</li>


                        
                            

<li >
    <a href="../../reference/expressive-projects/">Expressive Projects</a>
</li>


                        
                            

<li >
    <a href="../../reference/migration/">Migration</a>
</li>


                        
                        </ul>
                    </li>
                
                
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">v2 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            

<li >
    <a href="../../../v2/">Home</a>
</li>


                        
                            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Getting Started</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../../v2/getting-started/features/">Overview and Features</a>
</li>


        
            

<li >
    <a href="../../../v2/getting-started/standalone/">Quick Start: Standalone</a>
</li>


        
            

<li >
    <a href="../../../v2/getting-started/skeleton/">Quick Start: Skeleton Installer</a>
</li>


        
    </ul>
  </li>


                        
                            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Features</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../../v2/features/middleware-types/">Middleware Types</a>
</li>


        
            

<li >
    <a href="../../../v2/features/application/">Applications</a>
</li>


        
            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Containers</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../../v2/features/container/intro/">Introduction</a>
</li>


        
            

<li >
    <a href="../../../v2/features/container/factories/">Container Factories</a>
</li>


        
            

<li >
    <a href="../../../v2/features/container/delegator-factories/">Delegator Factories</a>
</li>


        
            

<li >
    <a href="../../../v2/features/container/zend-servicemanager/">Using zend-servicemanager</a>
</li>


        
            

<li >
    <a href="../../../v2/features/container/pimple/">Using Pimple</a>
</li>


        
            

<li >
    <a href="../../../v2/features/container/aura-di/">Using Aura.Di</a>
</li>


        
    </ul>
  </li>


        
            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Routing Adapters</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../../v2/features/router/intro/">Introduction</a>
</li>


        
            

<li >
    <a href="../../../v2/features/router/interface/">Routing Interface</a>
</li>


        
            

<li >
    <a href="../../../v2/features/router/uri-generation/">URI Generation</a>
</li>


        
            

<li >
    <a href="../../../v2/features/router/piping/">Routing vs Piping</a>
</li>


        
            

<li >
    <a href="../../../v2/features/router/aura/">Using Aura</a>
</li>


        
            

<li >
    <a href="../../../v2/features/router/fast-route/">Using FastRoute</a>
</li>


        
            

<li >
    <a href="../../../v2/features/router/zf2/">Using the ZF2 Router</a>
</li>


        
    </ul>
  </li>


        
            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Templating</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../../v2/features/template/intro/">Introduction</a>
</li>


        
            

<li >
    <a href="../../../v2/features/template/interface/">Template Renderer Interface</a>
</li>


        
            

<li >
    <a href="../../../v2/features/template/middleware/">Templated Middleware</a>
</li>


        
            

<li >
    <a href="../../../v2/features/template/plates/">Using Plates</a>
</li>


        
            

<li >
    <a href="../../../v2/features/template/twig/">Using Twig</a>
</li>


        
            

<li >
    <a href="../../../v2/features/template/zend-view/">Using zend-view</a>
</li>


        
    </ul>
  </li>


        
            

<li >
    <a href="../../../v2/features/error-handling/">Error Handling</a>
</li>


        
            

<li >
    <a href="../../../v2/features/modular-applications/">Modular Applications</a>
</li>


        
            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Middleware</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../../v2/features/middleware/implicit-methods-middleware/">Implicit HEAD and OPTIONS Middleware</a>
</li>


        
    </ul>
  </li>


        
            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Helpers</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../../v2/features/helpers/intro/">Introduction</a>
</li>


        
            

<li >
    <a href="../../../v2/features/helpers/url-helper/">UrlHelper</a>
</li>


        
            

<li >
    <a href="../../../v2/features/helpers/server-url-helper/">ServerUrlHelper</a>
</li>


        
            

<li >
    <a href="../../../v2/features/helpers/body-parse/">Body Parsing Middleware</a>
</li>


        
            

<li >
    <a href="../../../v2/features/helpers/content-length/">Content-Length Middleware</a>
</li>


        
    </ul>
  </li>


        
            

<li >
    <a href="../../../v2/features/emitters/">Emitters</a>
</li>


        
    </ul>
  </li>


                        
                            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Cookbook</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../../v2/cookbook/autowiring-routes-and-pipelines/">Autowiring routes and pipeline middleware</a>
</li>


        
            

<li >
    <a href="../../../v2/cookbook/common-prefix-for-routes/">Prepending a common path to all routes</a>
</li>


        
            

<li >
    <a href="../../../v2/cookbook/route-specific-pipeline/">Route-specific middleware pipelines</a>
</li>


        
            

<li >
    <a href="../../../v2/cookbook/using-custom-view-helpers/">Registering custom view helpers when using zend-view</a>
</li>


        
            

<li >
    <a href="../../../v2/cookbook/using-zend-form-view-helpers/">Using zend-form view helpers</a>
</li>


        
            

<li >
    <a href="../../../v2/cookbook/using-a-base-path/">Using Expressive from a subdirectory</a>
</li>


        
            

<li >
    <a href="../../../v2/cookbook/setting-locale-depending-routing-parameter/">Setting a locale based on a routing parameter</a>
</li>


        
            

<li >
    <a href="../../../v2/cookbook/setting-locale-without-routing-parameter/">Setting a locale without a routing parameter</a>
</li>


        
            

<li >
    <a href="../../../v2/cookbook/debug-toolbars/">Enabling debug toolbars</a>
</li>


        
            

<li >
    <a href="../../../v2/cookbook/using-routed-middleware-class-as-controller/">Handling multiple routes in a single class</a>
</li>


        
            

<li >
    <a href="../../../v2/cookbook/flash-messengers/">Flash Messengers</a>
</li>


        
            

<li >
    <a href="../../../v2/cookbook/passing-data-between-middleware/">Passing data between middleware</a>
</li>


        
    </ul>
  </li>


                        
                            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Reference</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../../v2/why-expressive/">Why choose Expressive?</a>
</li>


        
            

<li >
    <a href="../../../v2/reference/cli-tooling/">CLI Tooling</a>
</li>


        
            

<li >
    <a href="../../../v2/reference/usage-examples/">Examples</a>
</li>


        
            

<li >
    <a href="../../../v2/reference/expressive-projects/">Expressive Projects</a>
</li>


        
            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Migration</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../../v2/reference/migration/">To version 2</a>
</li>


        
            

<li >
    <a href="../../../v2/reference/migration-to-v2-2/">To version 2.2</a>
</li>


        
    </ul>
  </li>


        
    </ul>
  </li>


                        
                        </ul>
                    </li>
                
                
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">v1 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            

<li >
    <a href="../../../v1/">Home</a>
</li>


                        
                            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Getting Started</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../../v1/getting-started/features/">Overview and Features</a>
</li>


        
            

<li >
    <a href="../../../v1/getting-started/standalone/">Quick Start: Standalone</a>
</li>


        
            

<li >
    <a href="../../../v1/getting-started/skeleton/">Quick Start: Skeleton Installer</a>
</li>


        
    </ul>
  </li>


                        
                            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Features</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../../v1/features/application/">Applications</a>
</li>


        
            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Containers</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../../v1/features/container/intro/">Introduction</a>
</li>


        
            

<li >
    <a href="../../../v1/features/container/factories/">Container Factories</a>
</li>


        
            

<li >
    <a href="../../../v1/features/container/zend-servicemanager/">Using zend-servicemanager</a>
</li>


        
            

<li >
    <a href="../../../v1/features/container/pimple/">Using Pimple</a>
</li>


        
            

<li >
    <a href="../../../v1/features/container/aura-di/">Using Aura.Di</a>
</li>


        
    </ul>
  </li>


        
            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Routing Adapters</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../../v1/features/router/intro/">Introduction</a>
</li>


        
            

<li >
    <a href="../../../v1/features/router/interface/">Routing Interface</a>
</li>


        
            

<li >
    <a href="../../../v1/features/router/uri-generation/">URI Generation</a>
</li>


        
            

<li >
    <a href="../../../v1/features/router/piping/">Routing vs Piping</a>
</li>


        
            

<li >
    <a href="../../../v1/features/router/aura/">Using Aura</a>
</li>


        
            

<li >
    <a href="../../../v1/features/router/fast-route/">Using FastRoute</a>
</li>


        
            

<li >
    <a href="../../../v1/features/router/zf2/">Using the ZF2 Router</a>
</li>


        
    </ul>
  </li>


        
            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Templating</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../../v1/features/template/intro/">Introduction</a>
</li>


        
            

<li >
    <a href="../../../v1/features/template/interface/">Template Renderer Interface</a>
</li>


        
            

<li >
    <a href="../../../v1/features/template/middleware/">Templated Middleware</a>
</li>


        
            

<li >
    <a href="../../../v1/features/template/plates/">Using Plates</a>
</li>


        
            

<li >
    <a href="../../../v1/features/template/twig/">Using Twig</a>
</li>


        
            

<li >
    <a href="../../../v1/features/template/zend-view/">Using zend-view</a>
</li>


        
    </ul>
  </li>


        
            

<li >
    <a href="../../../v1/features/error-handling/">Error Handling</a>
</li>


        
            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Helpers</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../../v1/features/helpers/intro/">Introduction</a>
</li>


        
            

<li >
    <a href="../../../v1/features/helpers/url-helper/">UrlHelper</a>
</li>


        
            

<li >
    <a href="../../../v1/features/helpers/server-url-helper/">ServerUrlHelper</a>
</li>


        
            

<li >
    <a href="../../../v1/features/helpers/body-parse/">Body Parsing Middleware</a>
</li>


        
    </ul>
  </li>


        
            

<li >
    <a href="../../../v1/features/emitters/">Emitters</a>
</li>


        
    </ul>
  </li>


                        
                            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Cookbook</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../../v1/cookbook/common-prefix-for-routes/">Prepending a common path to all routes</a>
</li>


        
            

<li >
    <a href="../../../v1/cookbook/route-specific-pipeline/">Route-specific middleware pipelines</a>
</li>


        
            

<li >
    <a href="../../../v1/cookbook/custom-404-page-handling/">Setting custom 404 page handling</a>
</li>


        
            

<li >
    <a href="../../../v1/cookbook/using-custom-view-helpers/">Registering custom view helpers when using zend-view</a>
</li>


        
            

<li >
    <a href="../../../v1/cookbook/using-zend-form-view-helpers/">Using zend-form view helpers</a>
</li>


        
            

<li >
    <a href="../../../v1/cookbook/using-a-base-path/">Using Expressive from a subdirectory</a>
</li>


        
            

<li >
    <a href="../../../v1/cookbook/modular-layout/">Building modular applications</a>
</li>


        
            

<li >
    <a href="../../../v1/cookbook/setting-locale-depending-routing-parameter/">Setting a locale based on a routing parameter</a>
</li>


        
            

<li >
    <a href="../../../v1/cookbook/setting-locale-without-routing-parameter/">Setting a locale without a routing parameter</a>
</li>


        
            

<li >
    <a href="../../../v1/cookbook/debug-toolbars/">Enabling debug toolbars</a>
</li>


        
            

<li >
    <a href="../../../v1/cookbook/using-routed-middleware-class-as-controller/">Handling multiple routes in a single class</a>
</li>


        
            

<li >
    <a href="../../../v1/cookbook/flash-messengers/">Flash Messengers</a>
</li>


        
    </ul>
  </li>


                        
                            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Reference</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../../v1/why-expressive/">Why choose Expressive?</a>
</li>


        
            

<li >
    <a href="../../../v1/reference/usage-examples/">Examples</a>
</li>


        
            

<li >
    <a href="../../../v1/reference/expressive-projects/">Expressive Projects</a>
</li>


        
            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Migration</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../../../v1/reference/migration/rc-to-v1/">From RC5 and Earlier</a>
</li>


        
            

<li >
    <a href="../../../v1/reference/migration/to-v1-1/">To Expressive 1.1</a>
</li>


        
    </ul>
  </li>


        
    </ul>
  </li>


                        
                        </ul>
                    </li>
                
                
                
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" class="component-toggle" data-toggle="tooltip" data-placement="bottom" title="Show component list">
                        <i class="fa fa-book"></i> Components
                    </a>
                </li>

                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li>
                        <a href="https://github.com/zendframework/zend-expressive/">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

    <!-- content:begin -->
    <div id="page-top" class="container docs">
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#how-can-i-autowire-routes-and-pipelines">How can I autowire routes and pipelines?</a></li>
        
            <li><a href="#applicationconfiginjectiondelegator">ApplicationConfigInjectionDelegator</a></li>
        
            <li><a href="#custom-delegator-factories">Custom delegator factories</a></li>
        
            <li><a href="#caution-pipelines">Caution: pipelines</a></li>
        
            <li><a href="#caution-third-party-distributed-modules">Caution: third-party, distributed modules</a></li>
        
            <li><a href="#synopsis">Synopsis</a></li>
        
    
    </ul>

    
    <ul class="pager hidden-print">
      <li class="previous">
        <a rel="prev" href="../../features/emitters/"><i class="fa fa-arrow-left"></i> Previous</a>
      </li>
      <li class="next">
        <a rel="next" href="../using-a-base-path/">Next <i class="fa fa-arrow-right"></i></a>
      </li>
    </ul>
    
</div></div>
        <div class="col-md-9" role="main">

<ol class="breadcrumb" role="navigation" aria-label="breadcrumbs navigation">
  <li><a href="../../..">Expressive</a></li>
  
    
      
        <li>Cookbook</li>
      
    
  
  <li class="active">Autowiring routes and pipeline middleware</li>
</ol>

<h1 id="how-can-i-autowire-routes-and-pipelines">How can I autowire routes and pipelines?</h1>
<p>Sometimes you may find you'd like to keep route definitions close to the
handlers and middleware they will invoke. This is particularly important if you
want to re-use a module or library in another project.</p>
<p>In this recipe, we'll demonstrate two mechanisms for doing so. One is a built-in
<a href="../../features/container/delegator-factories/">delegator factory</a>, and the other
is a custom delegator factory.</p>
<h2 id="applicationconfiginjectiondelegator">ApplicationConfigInjectionDelegator</h2>
<p>Expressive ships with the class <code>Zend\Expressive\Container\ApplicationConfigInjectionDelegator</code>,
which can be used as a delegator factory for the <code>Zend\Expressive\Application</code>
class in order to automate piping of pipeline middleware and routing to request
handlers and middleware.</p>
<p>The delegator factory looks for configuration that looks like the following:</p>
<pre class="codehilite"><code class="language-php">return [
    'pipeline_middleware' =&gt; [
        [
            // required:
            'middleware' =&gt; 'Middleware service or pipeline',
            // optional:
            'path'  =&gt; '/path/to/match', // for path-segregated middleware
            'priority' =&gt; 1,             // integer; to ensure specific order
        ]
    ],
    'routes' =&gt; [
        [
            'path' =&gt; '/path/to/match',
            'middleware' =&gt; 'Middleware service or pipeline',
            'allowed_methods' =&gt; ['GET', 'POST', 'PATCH'],
            'name' =&gt; 'route.name',
            'options' =&gt; [
                'stuff' =&gt; 'to',
                'pass'  =&gt; 'to',
                'the'   =&gt; 'underlying router',
            ],
        ],
        'another.route.name' =&gt; [
            'path' =&gt; '/another/path/to/match',
            'middleware' =&gt; 'Middleware service or pipeline',
            'allowed_methods' =&gt; ['GET', 'POST'],
            'options' =&gt; [
                'more'    =&gt; 'router',
                'options' =&gt; 'here',
            ],
        ],
    ],
];</code></pre>

<p>This configuration may be placed at the application level, in a file under
<code>config/autoload/</code>, or within a module's <code>ConfigProvider</code> class. For details on
what values are accepted, see below.</p>
<p>In order to enable the delegator factory, you will need to define the following
service configuration somewhere, either at the application level in a
<code>config/autoload/</code> file, or within a module-specific <code>ConfigProvider</code> class:</p>
<pre class="codehilite"><code class="language-php">return [
    'dependencies' =&gt; [
        'delegators' =&gt; [
            \Zend\Expressive\Application::class =&gt; [
                \Zend\Expressive\Container\ApplicationConfigInjectionDelegator::class,
            ],
        ],
    ],
];</code></pre>

<h3 id="pipeline-middleware">Pipeline middleware</h3>
<p>Pipeline middleware are each described as an associative array, with the
following keys:</p>
<ul>
<li><code>middleware</code> (<strong>required</strong>, string or array): the value should be a middleware
  service name, or an array of service names (in which case a <code>MiddlewarePipe</code>
  will be created and piped).</li>
<li><code>path</code> (optional, string): if you wish to path-segregate the middleware, provide a
  literal path prefix that must be matched in order to dispatch the given
  middleware.</li>
<li><code>priority</code> (optional, integer): The elements in the <code>pipeline_middleware</code>
  section are piped to the application in the order in which they are discovered
  &mdash; which could have ramifications if multiple components and/or modules
  provide pipeline middleware. If you wish to force a certain order, you may use
  the <code>priority</code> to do so. Higher value integers are piped first, lower value
  (including <em>negative</em> values), last. If two middleware use the same priority,
  they will be piped in the order discovered.</li>
</ul>
<h3 id="routed-middleware">Routed middleware</h3>
<p>Routed middleware are also each described as an associative array, using the
following keys:</p>
<ul>
<li><code>path</code> (<strong>required</strong>, string): the path specification to match; this will be
  dependent on the router implementation you use.</li>
<li><code>middleware</code> (<strong>required</strong>, string or array): the value should be a middleware
  service name, or an array of service names (in which case a <code>MiddlewarePipe</code>
  will be created and piped).</li>
<li><code>allowed_methods</code> (optional, array or value of `Zend\Expressive\Route\HTTP_METHOD_ANY):
  the HTTP methods allowed for the route. If this is omitted, the assumption is
  any method is allowed.</li>
<li><code>name</code> (optional, string): the name of the route, if any; this can be used
  later to generate a URI based on the route, and must be unique. The name may
  also be set using a string key in the routes configuration array. If both are
  set the name assigned in the spec will be used.</li>
<li><code>options</code> (optional, array): any options to provide to the generated route.
  These might be default values or constraints, depending on the router
  implementation.</li>
</ul>
<h2 id="custom-delegator-factories">Custom delegator factories</h2>
<p>As outlined in the introduction to this recipe, we can also create our own
custom delegator factories in order to inject pipeline or routed middleware.
Unlike the above solution, the solution we will outline here will exercise the
<code>Zend\Expressive\Application</code> API in order to populate it.</p>
<p>First, we'll create the class <code>App\Factory\PipelineAndRoutesDelegator</code>, with
the following contents:</p>
<pre class="codehilite"><code class="language-php">&lt;?php

namespace App\Factory;

use App\Handler;
use Psr\Container\ContainerInterface;
use Zend\Expressive\Application;
use Zend\Expressive\Handler\NotFoundHandler;
use Zend\Expressive\Helper\ServerUrlMiddleware;
use Zend\Expressive\Helper\UrlHelperMiddleware;
use Zend\Expressive\Router\Middleware\DispatchMiddleware;
use Zend\Expressive\Router\Middleware\ImplicitHeadMiddleware;
use Zend\Expressive\Router\Middleware\ImplicitOptionsMiddleware;
use Zend\Expressive\Router\Middleware\MethodNotAllowedMiddleware;
use Zend\Expressive\Router\Middleware\RouteMiddleware;
use Zend\Stratigility\Middleware\ErrorHandler;

class PipelineAndRoutesDelegator
{
    public function __invoke(
        ContainerInterface $container,
        string $serviceName,
        callable $callback
    ) : Application {
        /** @var $app Application */
        $app = $callback();

        // Setup pipeline:
        $app-&gt;pipe(ErrorHandler::class);
        $app-&gt;pipe(ServerUrlMiddleware::class);
        $app-&gt;pipe(RouteMiddleware::class);
        $app-&gt;pipe(ImplicitHeadMiddleware::class);
        $app-&gt;pipe(ImplicitOptionsMiddleware::class);
        $app-&gt;pipe(MethodNotAllowedMiddleware::class);
        $app-&gt;pipe(UrlHelperMiddleware::class);
        $app-&gt;pipe(DispatchMiddleware::class);
        $app-&gt;pipe(NotFoundHandler::class);

        // Setup routes:
        $app-&gt;get('/', Handler\HomePageHandler::class, 'home');
        $app-&gt;get('/api/ping', Handler\PingHandler::class, 'api.ping');

        return $app;
    }
}</code></pre>

<blockquote>
<h3 id="where-to-put-the-factory">Where to put the factory</h3>
<p>You will place the factory class in one of the following locations:</p>
<ul>
<li><code>src/App/Factory/PipelineAndRoutesDelegator.php</code> if using the default, flat,
  application structure.</li>
<li><code>src/App/src/Factory/PipelineAndRoutesDelegator.php</code> if using the
  recommended, modular, application structure.</li>
</ul>
</blockquote>
<p>Once you've created this, edit the class <code>App\ConfigProvider</code>; in it, we'll
update the <code>getDependencies()</code> method to add the delegator factory:</p>
<pre class="codehilite"><code class="language-php">public function getDependencies()
{
    return [
        /* . . . */
        'delegators' =&gt; [
            \Zend\Expressive\Application::class =&gt; [
                Factory\PipelineAndRoutesDelegator::class,
            ],
        ],
    ];
}</code></pre>

<blockquote>
<h3 id="where-is-the-configprovider-class">Where is the ConfigProvider class?</h3>
<p>The <code>ConfigProvider</code> class is in one of the following locations:</p>
<ul>
<li><code>src/App/ConfigProvider.php</code> if using the default, flat, application
  structure.</li>
<li><code>src/App/src/ConfigProvider.php</code> using the recommended, modular, application
  structure.</li>
</ul>
<h3 id="why-is-an-array-assigned">Why is an array assigned?</h3>
<p>As noted above in the description of delegator factories, since each delegator
factory returns an instance, you can nest multiple delegator factories in
order to shape initialization of a service. As such, they are assigned as an
<em>array</em> to the service.</p>
</blockquote>
<p>If you're paying careful attention to this example, it essentially replaces
both <code>config/pipeline.php</code> and <code>config/routes.php</code>! If you were to update those
files to remove the default pipeline and routes, you should find that reloading
your application returns the exact same results!</p>
<h2 id="caution-pipelines">Caution: pipelines</h2>
<p>Using delegator factories is a nice way to keep your routing and pipeline
configuration close to the modules in which they are defined. However, there is
a caveat: you likely should <strong>not</strong> register pipeline middleware in a delegator
factory <em>other than within your root application module</em>.</p>
<p>The reason for this is simple: pipelines are linear, and specific to your
application. If one module pipes in middleware, there's no guarantee it will be
piped before or after your main pipeline, and no way to pipe the middleware at a
position in the middle of the pipeline!</p>
<p>As such:</p>
<ul>
<li>Use a <code>config/pipeline.php</code> file for your pipeline, <strong>OR</strong></li>
<li>Ensure you only define the pipeline in a <strong>single</strong> delegator factory on your
  <code>Application</code> instance.</li>
</ul>
<h2 id="caution-third-party-distributed-modules">Caution: third-party, distributed modules</h2>
<p>If you are developing a module to distribute as a package via
<a href="https://getcomposer.org/">Composer</a>, <strong>you should not autowire any delegator
factories that inject pipeline middleware or routes in the <code>Application</code></strong>.</p>
<p>Why?</p>
<p>As noted in the above section, pipelines should be created exactly once, at
the application level. Registering pipeline middleware within a distributable
package will very likely not have the intended consequences.</p>
<p>If you ship with pipeline middleware, we suggest that you:</p>
<ul>
<li>Document the middleware, and where you anticipate it being used in the
  middleware pipeline.</li>
<li>Document how to add the middleware service to dependency configuration, or
  provide the dependency configuration via your module's <code>ConfigProvider</code>.</li>
</ul>
<p>With regards to routes, there are other considerations:</p>
<ul>
<li>
<p>Routes defined by the package might conflict with the application, or with
  other packages used by the application.</p>
</li>
<li>
<p>Routing definitions are typically highly specific to the router implementation
  in use. As an example, each of the currently supported router implementations
  has a different syntax for placeholders:</p>
<ul>
<li><code>/user/:id</code> + "constraints" configuration to define constraints (zend-router)</li>
<li><code>/user/{id}</code> + "tokens" configuration to define constraints (Aura.Router)</li>
<li><code>/user/{id:\d+}</code> (FastRoute)</li>
</ul>
</li>
<li>
<p>Your application may have specific routing considerations or design.</p>
</li>
</ul>
<p>You could, of course, detect what router is in use, and provide routing for each
known, supported router implementation within your delegator factory. We even
recommend doing exactly that. However, we note that such an approach does not
solve the other two points above.</p>
<p>However, we still recommend <em>shipping</em> a delegator factory that would register
your routes, since routes <em>are</em> often a part of module design; just <strong>do not
autowire</strong> that delegator factory. This way, end-users who <em>can</em> use the
defaults do not need to cut-and-paste routing definitions from your
documentation into their own applications; they will instead opt-in to your
delegator factory by wiring it into their own configuration.</p>
<h2 id="synopsis">Synopsis</h2>
<ul>
<li>We recommend using delegator factories for the purpose of autowiring routes,
  and, with caveats, pipeline middleware:<ul>
<li>The pipeline should be created exactly once, so calls to <code>pipe()</code> should
  occur in exactly <em>one</em> delegator factory.</li>
</ul>
</li>
<li>Distributable packages should create a delegator factory for <em>routes only</em>,
  but <em>should not</em> register the delegator factory by default.</li>
</ul>

<hr />


<nav>
  <ul class="pager hidden-print">
    <li class="previous">
      <a rel="prev" href="../../features/emitters/"><i class="fa fa-arrow-left"></i> Previous</a>
    </li>
    <li class="next">
      <a rel="next" href="../using-a-base-path/">Next <i class="fa fa-arrow-right"></i></a>
    </li>
  </ul>
</nav>
</div>
        
    </div>
    <!-- content:end -->

    <div id="footerwrap">
    <div class="container">
        <div class="row site-map">
            <div class="col-lg-3">
              <p>
                <strong>Zend Framework</strong><br />
                <a href="https://framework.zend.com/">framework.zend.com</a><br />
                <a href="https://docs.zendframework.com">docs.zendframework.com</a><br />
                <a href="https://packages.zendframework.com">packages.zendframework.com</a><br />
                <a href="https://apigility.org">apigility.org</a><br />
              </p>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12 centered">
                <a class="back-to-top" href="#page-top"><i class="fa fa-chevron-circle-up fa-4" aria-hidden="true"></i></a>
            </div>
        </div>

        <div class="spacing"></div>

        <div class="row">
            <div class="col-lg-8">
                <h4>Copyright</h4>
                <div class="hline-w"></div>

                <p>&copy; 2006-2017 by <a href="https://www.zend.com/">Zend</a>, a <a href="https://www.roguewave.com/">Rogue Wave Company</a>.</p>
            </div>

            <div class="col-lg-4">
                <h4>Contacts</h4>
                <div class="hline-w"></div>
                <p>
                    <a href="https://discourse.zendframework.com" class="btn-social btn-outline" alt="Forum" title="Forum"><i class="fa fa-comments"></i></a>
                    <a href="https://zendframework-slack.herokuapp.com" class="btn-social btn-outline" alt="Slack" title="Slack"><i class="fa fa-slack"></i></a>
                    <a href="https://github.com/zendframework" class="btn-social btn-outline" alt="Github" title="Github"><i class="fa fa-github"></i></a>
                    <a href="https://twitter.com/zfdevteam" class="btn-social btn-outline" alt="Twitter" title="Twitter"><i class="fa fa-twitter"></i></a>
                </p>
            </div>
        </div>
    </div>
</div>

    <script src="https://cdn.jsdelivr.net/npm/jquery@2.2.4/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>
    <script>var base_url = '../../..';</script>
    <script src="../../../js/scripts-0b6185f4a5.js"></script>
    <script data-main="../../../mkdocs/js/search.js" src="../../../mkdocs/js/require.js"></script>
        <script src="../../../search/require.js"></script>
        <script src="../../../search/search.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    <div class="zf-components">
  <div class="zf-components-grid">
    <div class="zf-logo">
      <a href="https://framework.zend.com" data-toggle="tooltip" data-placement="bottom" title="Go to the ZF homepage"><img src="../../../img/zf-logo-mark.svg" alt="Zend Framework" width="250" /></a>
    </div>

    <div class="component-list"></div>

    <p class="zf-components-rollup"><a href="#">Hide list</a></p>
  </div>
</div>

</body>


</html>
